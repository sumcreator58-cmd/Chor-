<?php
session_start();

/* =========================
   SIMPLE DATABASE (JSON)
========================= */
$file = "appointments.json";
if(!file_exists($file)){
    file_put_contents($file, json_encode([]));
}

/* ===== LOGIN ===== */
if(isset($_POST['login'])){
    if($_POST['user']=="admin" && $_POST['pass']=="1234"){
        $_SESSION['admin']=true;
    }
}

/* ===== LOGOUT ===== */
if(isset($_GET['logout'])){
    session_destroy();
    header("Location:index.php");
}

/* ===== SAVE APPOINTMENT ===== */
if(isset($_POST['book'])){
    $data=json_decode(file_get_contents($file),true);

    $new=[
        "name"=>$_POST['name'],
        "phone"=>$_POST['phone'],
        "email"=>$_POST['email'],
        "symptoms"=>$_POST['symptoms'],
        "date"=>$_POST['date'],
        "time"=>$_POST['time'],
        "status"=>"Pending"
    ];

    $data[]=$new;
    file_put_contents($file,json_encode($data));
}

/* ===== UPDATE STATUS ===== */
if(isset($_GET['approve'])){
    $data=json_decode(file_get_contents($file),true);
    $data[$_GET['approve']]['status']="Approved";
    file_put_contents($file,json_encode($data));
}
if(isset($_GET['reject'])){
    $data=json_decode(file_get_contents($file),true);
    $data[$_GET['reject']]['status']="Rejected";
    file_put_contents($file,json_encode($data));
}

$appointments=json_decode(file_get_contents($file),true);
?>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Dr. Tara Kapoor | Premium Healthcare</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<style>

/* =====================
   GLOBAL STYLE
===================== */
body{
margin:0;
font-family:Arial;
background:linear-gradient(135deg,#02111f,#041f33);
color:white;
overflow-x:hidden;
}

section{padding:80px 20px;text-align:center; position: relative; z-index: 1;}

h1,h2{font-weight:300;letter-spacing:1px;}

.glass{
background:rgba(255,255,255,0.05);
backdrop-filter:blur(15px);
border:1px solid rgba(255,255,255,0.2);
border-radius:15px;
}

/* =====================
   NAVBAR
===================== */
nav{
position:fixed;
top:0;width:100%;
display:flex;
justify-content:space-between;
padding:15px 30px;
background:rgba(0,0,0,0.3);
backdrop-filter:blur(10px);
z-index:10;
box-sizing: border-box;
}

.brand {
font-size: 1.2rem;
font-weight: bold;
letter-spacing: 1px;
}

nav a{
color:white;
text-decoration:none;
margin:0 10px;
position:relative;
}

nav a:after{
content:"";
position:absolute;
bottom:-5px;
left:0;width:0;height:2px;
background:cyan;
transition:.4s;
}
nav a:hover:after{width:100%;}

/* =====================
   BUTTONS
===================== */
.btn{
padding:12px 25px;
border:2px solid cyan;
background:transparent;
color:white;
border-radius:30px;
cursor:pointer;
transition:.3s;
position:relative;
overflow:hidden;
}

.btn:hover{
box-shadow:0 0 20px cyan;
transform:translateY(-3px);
}

.btn:active{
transform:scale(.95);
}

/* =====================
   HERO & PROFILE
===================== */
#hero{
height:100vh;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
}

.profile-pic {
width: 180px;
height: 180px;
border-radius: 50%;
object-fit: cover;
border: 3px solid cyan;
box-shadow: 0 0 25px rgba(0, 255, 255, 0.5);
margin-bottom: 20px;
transition: transform 0.4s;
}

.profile-pic:hover {
transform: scale(1.05);
}

canvas{
position:fixed;
top:0;left:0;
z-index:0;
}

/* =====================
   CARDS
===================== */
.cards{
display:flex;
flex-wrap:wrap;
justify-content:center;
gap:20px;
}

.card{
width:260px;
padding:25px;
transition:.4s;
}

.card:hover{
transform:rotateY(10deg) translateY(-10px);
box-shadow:0 0 30px cyan;
}

/* =====================
   FORM
===================== */
input,textarea{
width:90%;
padding:12px;
margin:10px;
background:#02111f;
border:1px solid cyan;
color:white;
border-radius:8px;
box-sizing: border-box;
}

/* =====================
   TABLE
===================== */
table{
width:100%;
border-collapse:collapse;
margin-top: 20px;
}

td,th{
border:1px solid rgba(255,255,255,.2);
padding:10px;
}

/* =====================
   FOOTER
===================== */
footer {
background: rgba(0,0,0,0.5);
backdrop-filter: blur(10px);
border-top: 1px solid rgba(255,255,255,0.1);
padding: 40px 20px;
text-align: center;
position: relative;
z-index: 1;
margin-top: 50px;
}

.social-links a {
color: cyan;
text-decoration: none;
margin: 0 10px;
font-weight: bold;
transition: 0.3s;
}

.social-links a:hover {
text-shadow: 0 0 10px cyan;
}

/* =====================
   MOBILE
===================== */
@media(max-width:768px){
.cards{flex-direction:column;align-items:center;}
nav { flex-direction: column; align-items: center; gap: 10px; }
}

</style>
</head>

<body>

<nav>
<div class="brand">ü©∫ Dr. Tara Kapoor</div>
<div>
<a href="#hero">Home</a>
<a href="#services">Services</a>
<a href="#book">Appointment</a>
<a href="#admin">Admin</a>
</div>
</nav>

<section id="hero">
<img src="dr-tara-kapoor.jpg" alt="Dr. Tara Kapoor" class="profile-pic">
<h1 id="typing"></h1>
<p>Premium Healthcare Experience by Dr. Tara Kapoor</p>
<button class="btn" onclick="scrollToSection()">Book Appointment</button>
</section>

<section id="services">
<h2>Our Services</h2>
<div class="cards">
<div class="card glass">Cardiology</div>
<div class="card glass">General Consultation</div>
<div class="card glass">Diabetes Management</div>
<div class="card glass">Emergency Care</div>
</div>
</section>

<section id="book">
<h2>Book Appointment</h2>

<form method="POST" class="glass" style="max-width: 500px; margin: 0 auto; padding: 20px;">
<input name="name" placeholder="Name" required>
<input name="phone" placeholder="Phone" required>
<input name="email" placeholder="Email" required>
<textarea name="symptoms" placeholder="Symptoms"></textarea>
<input type="date" name="date" required>
<input type="time" name="time" required>
<br>
<button class="btn" name="book" style="margin-top: 15px;">Confirm Booking</button>
</form>

</section>

<section id="admin">
<h2>Admin Dashboard</h2>

<?php if(!isset($_SESSION['admin'])){ ?>

<form method="POST" class="glass" style="max-width: 400px; margin: 0 auto; padding: 20px;">
<input name="user" placeholder="Username">
<input type="password" name="pass" placeholder="Password">
<button class="btn" name="login" style="margin-top: 15px;">Login</button>
</form>

<?php } else { ?>

<a class="btn" href="?logout=1" style="display: inline-block; margin-bottom: 20px;">Logout</a>

<div style="overflow-x:auto;">
<table class="glass">
<tr>
<th>Name</th>
<th>Date</th>
<th>Time</th>
<th>Status</th>
<th>Action</th>
</tr>

<?php foreach($appointments as $i=>$a){ ?>
<tr>
<td><?= htmlspecialchars($a['name']) ?></td>
<td><?= htmlspecialchars($a['date']) ?></td>
<td><?= htmlspecialchars($a['time']) ?></td>
<td><?= htmlspecialchars($a['status']) ?></td>
<td>
<a class="btn" href="?approve=<?=$i?>" style="padding: 5px 10px; font-size: 0.8rem;">Approve</a>
<a class="btn" href="?reject=<?=$i?>" style="padding: 5px 10px; font-size: 0.8rem; border-color: #ff4d4d;">Reject</a>
</td>
</tr>
<?php } ?>

</table>
</div>

<?php } ?>
</section>

<footer>
    <div style="margin-bottom: 20px;">
        <h3 style="margin-top: 0;">Connect with Dr. Tara Kapoor</h3>
        <p>Providing premium healthcare with a personal touch.</p>
    </div>
    <div class="social-links">
        <a href="mailto:tarakapoor678@gmail.com">‚úâÔ∏è tarakapoor678@gmail.com</a>
        <a href="https://www.instagram.com/tarakapoor.irl?igsh=MThyY25qNHNvZHV4dQ==" target="_blank">üì∏ @tarakapoor.irl</a>
    </div>
    <p style="font-size: 0.8em; color: gray; margin-top: 30px;">&copy; <?php echo date("Y"); ?> Dr. Tara Kapoor. All rights reserved.</p>
</footer>

<script>

/* =========================
   TYPING EFFECT
========================= */
const text="Welcome to Dr. Tara Kapoor's Clinic";
let i=0;
function type(){
if(i<text.length){
document.getElementById("typing").innerHTML+=text.charAt(i);
i++;
setTimeout(type,60);
}}
type();

/* =========================
   SMOOTH SCROLL
========================= */
function scrollToSection(){
document.getElementById("book")
.scrollIntoView({behavior:"smooth"});
}

/* =========================
   THREE JS HERO
========================= */
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);

const renderer=new THREE.WebGLRenderer({alpha:true});
renderer.setSize(window.innerWidth,window.innerHeight);
// Insert canvas at the very beginning of the body so it stays behind everything
document.body.insertBefore(renderer.domElement, document.body.firstChild);

const geometry=new THREE.SphereGeometry(1.5,32,32); // Slightly larger
const material=new THREE.MeshBasicMaterial({wireframe:true, color: 0x00ffff, transparent: true, opacity: 0.15});
const sphere=new THREE.Mesh(geometry,material);

scene.add(sphere);
camera.position.z=4;

function animate(){
requestAnimationFrame(animate);
sphere.rotation.x+=0.001;
sphere.rotation.y+=0.002;
renderer.render(scene,camera);
}
animate();

// Handle window resize for Three.js
window.addEventListener('resize', onWindowResize, false);
function onWindowResize(){
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

/* =========================
   SCROLL REVEAL
========================= */
const observer=new IntersectionObserver(entries=>{
entries.forEach(e=>{
if(e.isIntersecting){
e.target.style.opacity=1;
e.target.style.transform="translateY(0)";
}
});
});

document.querySelectorAll("section").forEach(sec=>{
sec.style.opacity=0;
sec.style.transform="translateY(60px)";
sec.style.transition="1s";
observer.observe(sec);
});

</script>

</body>
</html>
